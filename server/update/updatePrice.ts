import axios from "axios";
//@ts-ignore
require("dotenv").config();
import { Model } from "mongoose";
const CoinsModels: typeof Model = require("../modules/Coins/M_Coins");

const CoinsSymbol = [
  "BTC",
  "ETH",
  "BNB",
  "ADA",
  "SOL",
  "XRP",
  "DOT",
  "DOGE",
  "SHIB",
  "USDC",
  "LUNA",
  "AVAX",
  "UNI",
  "LTC",
  "MATIC",
  "LINK",
  "BCH",
  "ATOM",
  "BUSD",
  "XLM",
  "VET",
  "AXS",
  "ICP",
  "TRX",
  "THETA",
  "FTM",
  "ETC",
  "ALGO",
  "FTT",
  "XTZ",
  "FIL",
  "EGLD",
  "XMR",
  "MANA",
  "EOS",
  "NEAR",
  "KLAY",
  "AAVE",
  "RUNE",
  "KSM",
  "HBAR",
  "CAKE",
  "NEO",
  "QNT",
  "MKR",
  "ONE",
  "GRT",
  "WAVES",
  "AR",
  "BTT",
  "ENJ",
  "HNT",
  "HOT",
  "STX",
  "CHZ",
  "SAND",
  "ZEC",
  "DASH",
  "OMG",
  "TFUEL",
  "XEM",
  "LRC",
  "CELO",
  "SUSHI",
  "CRV",
  "QTUM",
  "BAT",
  "DCR",
  "TUSD",
  "SNX",
  "MINA",
  "ZIL",
  "YFI",
  "LEND",
  "COMP",
  "RVN",
  "BTG",
  "ICX",
  "ZRX",
  "REN",
  "SC",
  "ZEN",
  "BNT",
  "ONT",
  "IOST",
  "IOTX",
  "NANO",
  "DGB",
  "1INCH",
  "WAXP",
  "UMA",
  "C98",
  "GNO",
  "DENT",
  "FET",
  "CELR",
  "RAY",
  "GALA",
  "OCEAN",
  "LPT",
  "NU",
  "WIN",
  "RSR",
  "CKB",
  "MDX",
  "WRX",
  "STORJ",
  "LSK",
  "REEF",
  "POLY",
  "KAVA",
  "KNC",
  "SRM",
  "XVG",
  "RLC",
  "COTI",
  "VTHO",
  "KEEP",
  "NKN",
  "BAND",
  "HIVE",
  "OGN",
  "ARDR",
  "CVC",
  "ELF",
  "AUDIO",
  "INJ",
  "ANKR",
  "ROSE",
  "STRAX",
  "CFX",
  "MIR",
  "REP",
  "XVS",
  "ARPA",
  "TLM",
  "BADGER",
  "MLN",
  "SXP",
  "TOMO",
  "NMR",
  "MTL",
  "REQ",
  "SKL",
  "POLS",
  "ORN",
  "FUN",
  "RIF",
  "ANT",
  "SYS",
  "DODO",
  "UTK",
  "JST",
  "BAL",
  "WAN",
  "BTS",
  "TROY",
  "IDEX",
  "STPT",
  "PHA",
  "DATA",
  "YFII",
  "AVA",
  "ERN",
  "KMD",
  "AKRO",
  "SUPER",
  "MFT",
  "LIT",
  "FORTH",
  "IRIS",
  "PAXG",
  "TRB",
  "RAMP",
  "BZRX",
  "ADX",
  "DNT",
  "FIRO",
  "AION",
  "FARM",
  "WNXM",
  "BLZ",
  "DIA",
  "LTO",
  "WTC",
  "ONG",
  "OM",
  "MBL",
  "QUICK",
  "EPS",
  "BEAM",
  "FIO",
  "DUSK",
  "VITE",
  "DOCK",
  "COS",
  "NULS",
  "CTXC",
  "TVK",
  "AUTO",
  "FOR",
  "RAD",
  "KEY",
  "VIDT",
  "MITH",
  "BURGER",
  "TORN",
  "PERL",
  "MBOX",
  "DEXE",
  "GTO",
  "PNT",
  "MDT",
  "HC",
  "TCT",
  "FIS",
  "JUV",
  "ALPACA",
  "USDS",
  "ACM",
  "CHESS",
  "OXT",
  "SUN",
  "SLP",
  "ALICE",
  "BAKE",
  "FLOW",
  "ALPHA",
  "TWT",
  "TKO",
  "ATA",
  "XEC",
  "YGG",
  "LINA",
  "CLV",
  "GBP",
  "EUR",
  "CTK",
  "BTCST",
  "STMX",
  "AUD",
  "UNFI",
  "TRIBE",
  "DF",
  "CVP",
  "WING",
  "NBS",
  "BOND",
  "AGLD",
  "TRU",
  "DREP",
  "GTC",
  "ATM",
  "NPXS",
  "BETA",
  "ERD",
  "USDP",
];

//!Update Price From Binance
const UpdatePrice = async () => {
  setInterval(async () => {
    await axios
      .get("https://api.binance.com/api/v3/ticker/24hr")
      .then(async (res) => {
        for (let i = 0; i < CoinsSymbol.length; i++) {
          const BtcInfoPrice = await res.data.filter((PriceInfo: any) => {
            if (PriceInfo.firstId !== -1) {
              return PriceInfo.symbol.startsWith(CoinsSymbol[i]);
            }
          });
          const filter = { symbol: `${CoinsSymbol[i]}` };
          const update = { price: BtcInfoPrice };
          await CoinsModels.findOneAndUpdate(filter, update);
        }
      })
      .catch((error) => {
        console.log(error);
      });
  }, 5000);
};

module.exports = { UpdatePrice };
